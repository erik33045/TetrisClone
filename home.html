<!DOCTYPE html>
<html>
<head>
    <title>
        Tetris Clone
    </title>
    <meta charset="utf-8">
    <style>
        table, th, td {
            border: 1px solid black;
            background-color: black;
            border-spacing: 1px;
        }

        td {
            height: 10px;
            width: 10px;
        }

        .emptycell {
            border: 1px solid black;
            background-color: black;
        }

        .debug{
            background-color: white;
            border: 1px solid black;
        }

        .opiece {
            background-color: yellow;
            border: 1px solid white;
        }

        .lpiece {
            background-color: blue;
            border: 1px solid white;
        }

        .jpiece {
            background-color: orangered;
            border: 1px solid white;
        }

        .ipiece {
            background-color: turquoise;
            border: 1px solid white;
        }

        .npiece {
            background-color: red;
            border: 1px solid white;
        }

        .zpiece {
            background-color: lime;
            border: 1px solid white;
        }

    </style>
    <link rel="stylesheet" href="qunit-1.12.0.css">
</head>

<body>
<table>
<tr>
    <td id="A0"></td>
    <td id="A1"></td>
    <td id="A2"></td>
    <td id="A3"></td>
    <td id="A4"></td>
    <td id="A5"></td>
    <td id="A6"></td>
    <td id="A7"></td>
    <td id="A8"></td>
    <td id="A9"></td>
</tr>
<tr>
    <td id="B0"></td>
    <td id="B1"></td>
    <td id="B2"></td>
    <td id="B3"></td>
    <td id="B4"></td>
    <td id="B5"></td>
    <td id="B6"></td>
    <td id="B7"></td>
    <td id="B8"></td>
    <td id="B9"></td>
</tr>
<tr>
    <td id="C0"></td>
    <td id="C1"></td>
    <td id="C2"></td>
    <td id="C3"></td>
    <td id="C4"></td>
    <td id="C5"></td>
    <td id="C6"></td>
    <td id="C7"></td>
    <td id="C8"></td>
    <td id="C9"></td>
</tr>
<tr>
    <td id="D0"></td>
    <td id="D1"></td>
    <td id="D2"></td>
    <td id="D3"></td>
    <td id="D4"></td>
    <td id="D5"></td>
    <td id="D6"></td>
    <td id="D7"></td>
    <td id="D8"></td>
    <td id="D9"></td>
</tr>
<tr>
    <td id="E0"></td>
    <td id="E1"></td>
    <td id="E2"></td>
    <td id="E3"></td>
    <td id="E4"></td>
    <td id="E5"></td>
    <td id="E6"></td>
    <td id="E7"></td>
    <td id="E8"></td>
    <td id="E9"></td>
</tr>
<tr>
    <td id="F0"></td>
    <td id="F1"></td>
    <td id="F2"></td>
    <td id="F3"></td>
    <td id="F4"></td>
    <td id="F5"></td>
    <td id="F6"></td>
    <td id="F7"></td>
    <td id="F8"></td>
    <td id="F9"></td>
</tr>
<tr>
    <td id="G0"></td>
    <td id="G1"></td>
    <td id="G2"></td>
    <td id="G3"></td>
    <td id="G4"></td>
    <td id="G5"></td>
    <td id="G6"></td>
    <td id="G7"></td>
    <td id="G8"></td>
    <td id="G9"></td>
</tr>
<tr>
    <td id="H0"></td>
    <td id="H1"></td>
    <td id="H2"></td>
    <td id="H3"></td>
    <td id="H4"></td>
    <td id="H5"></td>
    <td id="H6"></td>
    <td id="H7"></td>
    <td id="H8"></td>
    <td id="H9"></td>
</tr>
<tr>
    <td id="I0"></td>
    <td id="I1"></td>
    <td id="I2"></td>
    <td id="I3"></td>
    <td id="I4"></td>
    <td id="I5"></td>
    <td id="I6"></td>
    <td id="I7"></td>
    <td id="I8"></td>
    <td id="I9"></td>
</tr>
<tr>
    <td id="J0"></td>
    <td id="J1"></td>
    <td id="J2"></td>
    <td id="J3"></td>
    <td id="J4"></td>
    <td id="J5"></td>
    <td id="J6"></td>
    <td id="J7"></td>
    <td id="J8"></td>
    <td id="J9"></td>
</tr>
<tr>
    <td id="K0"></td>
    <td id="K1"></td>
    <td id="K2"></td>
    <td id="K3"></td>
    <td id="K4"></td>
    <td id="K5"></td>
    <td id="K6"></td>
    <td id="K7"></td>
    <td id="K8"></td>
    <td id="K9"></td>
</tr>
<tr>
    <td id="L0"></td>
    <td id="L1"></td>
    <td id="L2"></td>
    <td id="L3"></td>
    <td id="L4"></td>
    <td id="L5"></td>
    <td id="L6"></td>
    <td id="L7"></td>
    <td id="L8"></td>
    <td id="L9"></td>
</tr>
<tr>
    <td id="M0"></td>
    <td id="M1"></td>
    <td id="M2"></td>
    <td id="M3"></td>
    <td id="M4"></td>
    <td id="M5"></td>
    <td id="M6"></td>
    <td id="M7"></td>
    <td id="M8"></td>
    <td id="M9"></td>
</tr>
<tr>
    <td id="N0"></td>
    <td id="N1"></td>
    <td id="N2"></td>
    <td id="N3"></td>
    <td id="N4"></td>
    <td id="N5"></td>
    <td id="N6"></td>
    <td id="N7"></td>
    <td id="N8"></td>
    <td id="N9"></td>
</tr>
<tr>
    <td id="O0"></td>
    <td id="O1"></td>
    <td id="O2"></td>
    <td id="O3"></td>
    <td id="O4"></td>
    <td id="O5"></td>
    <td id="O6"></td>
    <td id="O7"></td>
    <td id="O8"></td>
    <td id="O9"></td>
</tr>
<tr>
    <td id="P0"></td>
    <td id="P1"></td>
    <td id="P2"></td>
    <td id="P3"></td>
    <td id="P4"></td>
    <td id="P5"></td>
    <td id="P6"></td>
    <td id="P7"></td>
    <td id="P8"></td>
    <td id="P9"></td>
</tr>
<tr>
    <td id="Q0"></td>
    <td id="Q1"></td>
    <td id="Q2"></td>
    <td id="Q3"></td>
    <td id="Q4"></td>
    <td id="Q5"></td>
    <td id="Q6"></td>
    <td id="Q7"></td>
    <td id="Q8"></td>
    <td id="Q9"></td>
</tr>
<tr>
    <td id="R0"></td>
    <td id="R1"></td>
    <td id="R2"></td>
    <td id="R3"></td>
    <td id="R4"></td>
    <td id="R5"></td>
    <td id="R6"></td>
    <td id="R7"></td>
    <td id="R8"></td>
    <td id="R9"></td>
</tr>
<tr>
    <td id="S0"></td>
    <td id="S1"></td>
    <td id="S2"></td>
    <td id="S3"></td>
    <td id="S4"></td>
    <td id="S5"></td>
    <td id="S6"></td>
    <td id="S7"></td>
    <td id="S8"></td>
    <td id="S9"></td>
</tr>
<tr>
    <td id="T0"></td>
    <td id="T1"></td>
    <td id="T2"></td>
    <td id="T3"></td>
    <td id="T4"></td>
    <td id="T5"></td>
    <td id="T6"></td>
    <td id="T7"></td>
    <td id="T8"></td>
    <td id="T9"></td>
</tr>
<tr>
    <td id="U0"></td>
    <td id="U1"></td>
    <td id="U2"></td>
    <td id="U3"></td>
    <td id="U4"></td>
    <td id="U5"></td>
    <td id="U6"></td>
    <td id="U7"></td>
    <td id="U8"></td>
    <td id="U9"></td>
</tr>
<tr>
    <td id="V0"></td>
    <td id="V1"></td>
    <td id="V2"></td>
    <td id="V3"></td>
    <td id="V4"></td>
    <td id="V5"></td>
    <td id="V6"></td>
    <td id="V7"></td>
    <td id="V8"></td>
    <td id="V9"></td>
</tr>
</table>

<div style="margin-top: 20px" id="qunit"></div>
<div id="qunit-fixture"></div>

<script src="jquery-1.10.2.min.js"></script>
<script src="qunit-1.12.0.js"></script>
<script type="text/javascript">

    function Piece(type, rotation, position){
      this.type = type;
      this.rotation = rotation;
      this.position = position;
      this.rotate = rotate;
      this.drawPiece = drawPiece;
      this.getCellsForPiece = GetCellsForPiece;
      this.pieceCanBeDrawn = PieceCanBeDrawn;

      function rotate(rotateRight){
          if(rotateRight)
              this.rotation = this.rotation + 90;
          else
              this.rotation = this.rotation - 90;

          if(this.rotation >= 360 || this.rotation <= 0)
              this.rotation = 0;
        }

      function drawPiece(topLeftCornerCellId){
          var cell = "#"+ topLeftCornerCellId;
          var pieceClass = "#" + this.type;

          var cellIdArray = GetCellsForPiece(topLeftCornerCellId);

          if(this.pieceCanBeDrawn(topLeftCornerCellId))

          for(var i = 0; i<cellIdArray; i++)
          {
              ChangeCellColor(this.type, cellIdArray[i]);
          }
      }

      function GetCellsForPiece(topLeftCornerCellId){
          var cellIdArray = [];

          switch(this.type)
          {
              case "lpiece":{
                  switch(this.rotation){
                      //Vertical l piece
                      case 0:
                      case 180: {
                          //(0,0)
                          cellIdArray[0] = topLeftCornerCellId;
                          //(0,1)
                          cellIdArray[1] = GetCellAboveOrBelow(cellIdArray[0],false);
                          //(0,2)
                          cellIdArray[2] = GetCellAboveOrBelow(cellIdArray[1],false);
                          //(0,3)
                          cellIdArray[3] = GetCellAboveOrBelow(cellIdArray[2],false);
                      }
                  }
              }
          }


          return cellIdArray;
      }

        /**
         * @return {boolean}
         */
        function PieceCanBeDrawn(cellIdArray){
          //Remove any duplicates due to the piece being out of the array. If size is equal to input, can place
          return cellIdArray.length == EliminateDuplicatesInArray(cellIdArray).length;
      }
    }



    function ChangeCellColor(cssClassName, cellId) {
        $("#" + cellId).removeClass()
                .addClass(cssClassName);
    }

    /**
     * @return {string}
     */
    function GetCellToRightOrLeft(cellId, cellToRight){
        var horizontalPosition = cellId.charCodeAt(0);

        if((horizontalPosition == 65 && !cellToRight) || (horizontalPosition == 86 && cellToRight))
            return cellId;
        else
            return String.fromCharCode(cellToRight ? horizontalPosition+1 : horizontalPosition -1) + cellId.substring(1);
    }

    /**
     * @return {string}
     */
    function GetCellAboveOrBelow(cellId, cellAbove)
    {
        var verticalPosition = cellId.charCodeAt(1);

        if((verticalPosition == 57 && !cellAbove) || (verticalPosition == 48 && cellAbove))
            return cellId;
        else
            return cellId.substring(0,1) + String.fromCharCode(cellAbove ? verticalPosition-1 : verticalPosition+1);
    }

    function EliminateDuplicatesInArray(arr) {
        var i,
                len=arr.length,
                out=[],
                obj={};

        for (i=0;i<len;i++) {
            obj[arr[i]]=0;
        }
        for (i in obj) {
            out.push(i);
        }
        return out;
    }
</script>

<!-- Below Are the Unit tests for the project -->
<script type="text/javascript" id="UnitTests">
    $(runUnitTests());
    function runUnitTests() {
        //noinspection JSUnresolvedFunction
        test("Test Change Cell Color To Yellow", function () {
            var cellId = "A0";
            ChangeCellColor("opiece", cellId);
            equal($("#" + cellId).css("backgroundColor"), "rgb(255, 255, 0)");
        });
        //noinspection JSUnresolvedFunction
        test("Test Reset Cell Color", function () {
            var cellId = "A0";
            ChangeCellColor("emptycell", cellId);
            equal($("#" + cellId).css("backgroundColor"), "rgb(0, 0, 0)");
        });
        test("Test Piece Rotation Right", function(){
            var piece = new Piece("jpiece", 180, "a0");
            piece.rotate(true);
            equal(piece.rotation, 270);
        });
        test("Test Piece Rotation Left", function(){
            var piece = new Piece("jpiece", 180, "a0");
            piece.rotate(false);
            equal(90, piece.rotation);
        });
        test("Test Find Cell Right, Cell Exists", function(){
            var cell = GetCellToRightOrLeft("B0", true)
            equal(cell, "C0");
        });
        test("Test Find Cell Right, Cell DNE", function(){
            var cell = GetCellToRightOrLeft("V0", true)
            equal(cell, "V0");
        });
        test("Test Find Cell Left, Cell Exists", function(){
            var cell = GetCellToRightOrLeft("C0", false)
            equal(cell, "B0");
        });
        test("Test Find Cell Left, Cell DNE", function(){
            var cell = GetCellToRightOrLeft("A0", false)
            equal(cell, "A0");
        });
        test("Test Find Cell Above, Cell Exists", function(){
            var cell = GetCellAboveOrBelow("A2", true)
            equal(cell, "A1");
        });
        test("Test Find Cell Above, Cell DNE", function(){
            var cell = GetCellAboveOrBelow("A0", true)
            equal(cell, "A0");
        });
        test("Test Find Cell Below, Cell Exists", function(){
            var cell = GetCellAboveOrBelow("A0", false)
            equal(cell, "A1");
        });
        test("Test Find Cell Below, Cell DNE", function(){
            var cell = GetCellAboveOrBelow("A9", false)
            equal(cell, "A9");
        });
        test("Test Get Cell Ids for L Piece, Vertical", function(){
            var piece = new Piece("lpiece", 0, "A0");
            var cellIdArray = piece.getCellsForPiece(piece.position);
            equal("A0", cellIdArray[0]);
            equal("A1", cellIdArray[1]);
            equal("A2", cellIdArray[2]);
            equal("A3", cellIdArray[3]);
        });
        test("Test Piece Can Be Placed", function(){
            var piece = new Piece("lpiece", 0, "A0");
            piece.getCellsForPiece(piece.position);
            ok(piece.pieceCanBeDrawn(piece.getCellsForPiece(piece.position)));
        });
        test("Test Piece Cannot Be Placed", function(){
            var piece = new Piece("lpiece", 0, "A8");
            piece.getCellsForPiece(piece.position);
            equal(false, piece.pieceCanBeDrawn(piece.getCellsForPiece(piece.position)));
        });
        test("Test Draw l piece vertical", function(){
            var piece = new Piece("lpiece", 0, "A0");
            piece.drawPiece("A0");
            ok(true);
        });
    }
</script>
</body>
</html>